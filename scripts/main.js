"use strict";var _get=function t(e,a,n){var i=Object.getOwnPropertyDescriptor(e,a);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,a,n)}if("value"in i)return i.value;var s=i.get;return void 0===s?void 0:s.call(n)},_inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},_classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),G_Sheet=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"assembleJSONUrl",value:function(t){return"https://cors-io.herokuapp.com/spreadsheets.google.com/feeds/list/"+this.sheetID+"/"+this.sheetEnum[t]+"/public/values?alt=json"}}]),t}();G_Sheet.sheetID="1OmNdBJjC71iyXzih4YTBdlxzDwCEjBkac8oW6kJBYIw",G_Sheet.sheetEnum={GALLERY:1,TIME:2,ANNOUNCEMENT:3};var Time=function(){function t(){var e=this;_classCallCheck(this,t);var a=this.getTime(),n=$("[data-time]");return n.html(a.format("h:mm:ss a")),setInterval(function(){a=e.getTime(),n.html(a.format("h:mm:ss a"))},1e3)}return _createClass(t,[{key:"getTime",value:function(){return moment().tz("Australia/Sydney")}}]),t}(),Presentation=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"dataLoaded",value:function(t){$("body").addClass("success"===t?"loaded":"load-fail")}}]),t}(),Gallery=function(t){function e(){var t=this;_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.slideDuration=1e4,this.images=[],this.loadData(function(e){t.dataLoaded(e)}),this.el={root:$("#gallery"),image:$("#galleryImage"),background:$("#galleryBackground"),captionBackground:$("#galleryCaptionBackground"),caption:$("#galleryCaption"),miniInfo:$("#galleryMiniInfo")}}return _inherits(e,t),_createClass(e,[{key:"dataLoaded",value:function(t){"success"===t&&(this.preloadImages(),this.el.background.css("animation-duration",4*this.slideDuration/3+"ms"),this.el.captionBackground.css("animation-duration",4*this.slideDuration/3+"ms"),this.imageIterator=Math.floor(Math.random()*(this.images.length-1)),this.setSlideView(this.images[this.imageIterator]),this.cycleImages()),_get(Object.getPrototypeOf(e.prototype),"dataLoaded",this).call(this,t)}},{key:"loadData",value:function(t){var e=this,a=G_Sheet.assembleJSONUrl("GALLERY");$.getJSON(a).done(function(a){for(var n=0;n<a.feed.entry.length;n++){var i=a.feed.entry[n],o=i.gsx$content.$t;o=o.replace(/\n{2}/g,"</p><p>"),o=o.replace(/\n/g,"<br />"),o="<p>"+o+"</p>",e.images.push({image:i.gsx$image.$t,name:i.gsx$title.$t,author:i.gsx$author.$t,text:o})}return t("success")}).fail(function(e,a,n){return t(n)})}},{key:"preloadImages",value:function(){for(var t=0;t<this.images.length;t++)$("<img />").attr("src",this.images[t].image)}},{key:"setSlideView",value:function(t){var e=this;this.loadImage(t),setTimeout(function(){e.el.root.addClass("caption")},this.slideDuration/3),setTimeout(function(){e.el.root.removeClass("caption")},this.slideDuration-5e3),setTimeout(function(){e.el.root.addClass("loading")},this.slideDuration-2e3)}},{key:"cycleImages",value:function(){var t=this;setInterval(function(){++t.imageIterator>t.images.length-1&&(t.imageIterator=0),t.setSlideView(t.images[t.imageIterator])},this.slideDuration)}},{key:"formatCaption",value:function(t){return"<h1>"+t.name+"</h1><p>By "+t.author+"</p>"+t.text}},{key:"formatMiniInfo",value:function(t){return"<strong>"+t.name+"</strong> by <em>"+t.author+"</em>"}},{key:"loadImage",value:function(t){var e=this,a="url("+t.image+")";this.el.background.removeClass("animate"),this.el.captionBackground.removeClass("animate"),this.el.image.attr("src",t.image),this.el.background.css("background-image",a),this.el.captionBackground.css("background-image",a),this.el.caption.html(this.formatCaption(t)),this.el.miniInfo.html(this.formatMiniInfo(t)),setTimeout(function(){e.el.background.addClass("animate"),e.el.captionBackground.addClass("animate"),e.el.root.removeClass("loading").addClass("loaded")},500),setTimeout(function(){e.el.root.removeClass("loaded")},this.slideDuration/2)}}]),e}(Presentation),TimeAlert=function(t){function e(){var t=this;_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.el={countdown:$("#timeAlertCountdown"),svg:$("#timeAlertSvg"),title:$("#timeAlertTitle")},this.times=[],this.loadData(function(e){t.dataLoaded(e)})}return _inherits(e,t),_createClass(e,[{key:"loadData",value:function(t){var e=this,a=G_Sheet.assembleJSONUrl("TIME"),n=new Date;$.getJSON(a).done(function(a){for(var i=0;i<a.feed.entry.length;i++){var o=a.feed.entry[i],s=o.gsx$classtimes.$t.split(":",2);s=new Date(n.getFullYear(),n.getMonth(),n.getDate(),s[0],s[1],0);var r=o.gsx$endtimes.$t.split(":",2);r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),r[0],r[1],0),e.times.push({start:s,end:r})}t("success")}).fail(function(e,a,n){return t(n)})}},{key:"dataLoaded",value:function(t){var a=this;if("success"===t){var n=this.calculateNearestClass(new Date);this.countdown=countdown(function(t){a.update(t)},n.start)}_get(Object.getPrototypeOf(e.prototype),"dataLoaded",this).call(this,t)}},{key:"calculateNearestClass",value:function(t){for(var e=0;e<this.times.length;e++)if(t<this.times[e].start)return this.times[e];var a={start:new Date(new Date(this.times[0].start).setDate(this.times[0].start.getDate()+1)),end:new Date(this.times[0].end)};return a}},{key:"update",value:function(t){t.value<0&&(this.el.title.html("You're late!"),t.minutes>=15&&this.clearCountdown());var e=(moment(),""),a=t.minutes;0!==t.hours&&(e=t.hours+":",a=("0"+t.minutes).slice(-2)),this.el.countdown.html(e+a+":"+("0"+t.seconds).slice(-2))}},{key:"clearCountdown",value:function(){window.clearInterval(this.countdown)}}]),e}(Presentation),Announcement=function(t){function e(){var t=this;_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),this.el={root:$("#announcement"),title:$("#announcementTitle"),content:$("#announcementContent")},this.title="",this.content="",this.image="";this.loadData(function(e){t.dataLoaded(e)})}return _inherits(e,t),_createClass(e,[{key:"loadData",value:function(t){var e=this,a=G_Sheet.assembleJSONUrl("ANNOUNCEMENT");$.getJSON(a).done(function(a){var n=a.feed.entry[0],i=n.gsx$content.$t;return i=i.replace(/\n{2}/g,"</p><p>"),i=i.replace(/\n/g,"<br />"),i="<p>"+i+"</p>",e.title=n.gsx$title.$t,e.content=i,e.image=n.gsx$picture.$t,t("success")}).fail(function(e,a,n){return t(n)})}},{key:"loadToView",value:function(){this.el.title.html(this.title),this.el.content.html(this.content)}},{key:"fitContent",value:function(){this.el.root.css({width:$("#announcement").css("width"),height:$("#announcement").css("height")}),textFit(this.el.root[0],{alignHoriz:!0,alignVert:!0,minFontSize:14,maxFontSize:36})}},{key:"dataLoaded",value:function(t){"success"===t&&(this.loadToView(),this.fitContent()),_get(Object.getPrototypeOf(e.prototype),"dataLoaded",this).call(this,t)}}]),e}(Presentation);$(function(){1===$("[data-gallery]").length&&new Gallery,1===$("[data-timealert]").length&&new TimeAlert,1===$("[data-time]").length&&new Time,1===$("[data-announcement]").length&&new Announcement});